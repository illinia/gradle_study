## Groovy 빌드 스크립트 입문서

### Project 객체

Groovy 는 Java 기반 객체지향 언어이므로 Groovy 의 속성과 메소드가 객체에 적용된다.

`version`, `configurations` 둘다 `org.gradle.api.Project` 의 일부이다.

이름이 규정되지 않은 경우 다음 중 하나일 수 있다.
* 해당 이름을 가진 작업 인스턴스
* Project 의 속성
* 프로젝트의 다른 위치에서 정의된 추가 속성
* 블록 내 암시적 객체의 속성
* 빌드 스크립트에서 이전에 정의된 로컬 변수

Project 플러그인은 객체 자체 속성을 추가할 수 있다.
API 문서에는 핵심 플러그인이 추가한 모든 속성이 나열되어 있다.

비 핵심 플러그인에 의해 추가된 빌드 스크립트에서 프로젝트 속성을 참조할 때 접두사를 추가하는 것을 고려해라
`project.` 그러면 속성이 프로젝트 객체에 속하는 것이 분명하다.

```groovy
project.getVersion()
project.version

project.setVersion('1.0.1')
project.version = '1.0.1'
```
## Gradle 빌드 언어 레퍼런스

1. Gradle 스크립트는 구성 스크립트이다. 스크립트가 실행되면 특정 유형의 객체를 구성한다.
이런 객체들을 위임 객체라고 한다.
2. Gradle 스크립트는 Script 인터페이스를 구현한다.

### 빌드 스크립트 구조

빌드 스크립트는 0개 이상의 문과 스크립트 블록으로 구성된다.
문에는 메서드 호출, 속성 할당, 지역 변수 정의가 포함될 수 있다.
최상위 수준 스크립트 블록
* allprojects {}: 이 프로젝트와 각 하위 프로젝트를 구성한다.
* artifacts {}: 이 프로젝트에 대해 게시된 아티팩트를 구성한다.
* buildscript {}: 이 프로젝트의 빌드 스크립트 클래스 경로를 구성한다.
* configurations {}: 이 프로젝트의 종속성 구성을 구성한다.
* dependencies {}: 이 프로젝트의 종속성을 구성한다.
* repositories {}: 이 프로젝트의 저장소를 구성한다.
* sourceSets {}: 이 프로젝트의 소스 세트를 구성한다.
* subprojects {}: 이 프로젝트의 하위 프로젝트를 구성한다.

빌드 스크립트는 Groovy 스크립트이기도 하므로 메서드 정의, 클래스 정의와 같이 Groovy 스크립트에서 허용되는 요소를 포함할 수 있다.

## Gradle Command-Line Interface

Gradle Wrapper 를 사용하는 것이 좋다.
`gradle :myTask`

작업에 옵션을 전달하려면 작업 이름 뒤에 옵션 이름 접두사를 붙인다.
`gradle exampleTask --exampleOption=예제값`

멀티 프로젝트 빌드에서 작업 실행시 하위 프로젝트 이름과 작업 이름을 구분하는 : 을 사용하여 실행 가능
`gradle :my-subproject:taskName`
`gradle my-subproject:taskName`

여러 작업 실행
`gradle test deploy`

작업 제외
`gradle dist --exclude-task test`

태스트 강제 실행
`gradle test --rerun-tasks`

작업 실패 후 빌드 계속
`gradle test --continue`

### 일반적인 작업

모든 아웃풋 계산
`gradle build`

애플리케이션 실행
`gradle run`

모든 검사 실행
`gradle check`

클린 아웃풋
clean task 를 사용해 빌드 디렉터리의 내용을 삭제할 수 있지만 이후 작업시 추가 빌드시간이 발생한다.
`gradle clean`

### 프로젝트 리포트

프로젝트 나열
하위 프로젝트 목록을 계층 구조로 표시합니다.
`gradle projects`

작업 나열
프로젝트의 주요 작업 목록을 제공한다.
`gradle tasks`

기본적으로 작업 그룹에 할당된 작업만 표시된다. 옵션을 사용하여 자세한 정보를 얻을 수 있다.
`gradle tasks --all`

더 정확해야 하는 경우 옵션을 사용하여 특정 그룹의 작업만 표시할 수 있다.
`gradle tasks --group="build setup"`

자세한 정보를 얻을 수 있다.
`gradle -q help --task libs`

종속성 확인
빌드 스캔은 시각적으로 종속성을 보여준다.
`gradle myTask --scan`

프로젝트 종속성 나열
해당 프로젝트의 종속성 목록을 구성별로 세분화하여 제공한다.
`gradle dependencies`


## 빌드 라이프사이클

### 구축 단계
1. 초기화
Gradle 은 빌드에 참여할 프로젝트를 결정하고 각 프로젝트에 대한 프로젝트 인스턴스를 생성한다.
2. 구성
프로젝트 객체가 구성된다. allprojects 빌드 스크립트가 실행된다.
3. 실행
구성 단계에서 생성, 구성되어 실행될 작업의 하위 집합을 결정한다.
gradle 하위 집합은 명령, 현재 디렉터리에 전달된 작업의 인수에 의해 결정된다.
그리고 선택한 각 작업을 실행한다.

### 설정 파일
기본 이름은 settings.gradle 이다.
멀티 프로젝트 빌드시에는 루트 프로젝트에 있어야 한다. 설정 파일이 멀티 프로젝트 빌드에 참여하는 프로젝트를 정의하기 때문.

### 초기화

파일이 있는 디렉토리에서 멀티 프로젝트 빌드를 하면 settings.gradle 을 사용하여 빌드한다.
파일이 없으면
1. settings.gradle 을 상위 디렉토리에서 찾는다.
2. 찾을 수 없으면 단일 프로젝트로 빌드된다.
3. 발견되면 현재 프로젝트가 발견된 파일에 정의된 멀티 프로젝트 계층 구조의 일부인지 확인한다.
그렇지 않으면 단일 프로젝트로 빌드된다.

Gradle 은 빌드에 참여하는 모든 프로젝트에 대해 Project 객체를 생성한다.

### 단일 프로젝트 빌드 구성 및 실행

빌드 스크립트는 초기화 단계에서 생성된 프로젝트 객체에 대해 실행된다.
그리고 Gradle 은 명령어 인수로 전달된 이름과 동일한 이름을 가진 작업을 찾는다.

### 빌드 스크립트에서 라이프사이클에 대응
빌드 스크립트는 빌드가 라이프 사이클을 통해 진행됨에 따라 알림을 받을 수 있다.
특정 리스너 인터페이스를 구현하거나 알림이 실행될 때 실행할 클로저를 제공할 수 있다.

프로젝트 평가

hasTests 속성값이 true 인 각 프로젝트에 작업을 추가하는 예

`Project.afterEvaluate()` 를 사용하여 프로젝트가 평가된 후 실행되는 클로저를 추가

gradle 객체의 afterProject

작업 생성

프로젝트에 작업이 추가된 후 알림을 받을 수 있다.

작업 실행

모든 작업이 실행되기 직전과 직후에 알림을 받을 수 있다.
다음 예제는 각 작업의 실행의 시작과 끝을 기록한다. 알림 afterTask 는 작업이 성공적으로 완료되었는지
또는 예외로 실패했는지 관계없이 수신된다.


## Gradle 이 사용하는 디렉토리 및 파일

### Gradle 사용자 홈 디렉토리

($USER_HOME/.gradle)은 전역 구성 속성, 초기화 스크립트, 캐시, 로그 파일을 저장하는데 사용
1. 전역 캐시 디렉터리
2. 버전별 캐시
3. 공유 캐시(jars, modules, ...)
4. Gradle daemon 레지스트리, 로그
5. 글로벌 초기화 스크립트
6. jdk
7. Gradle Wrapper 에서 다운로드한 배포판(dists)
8. 전역 Gradle 구성 속성

### 프로젝트 루트 디렉터리

프로젝트 일부인 모든 소스 파일이 포함.

1. Gradle 에서 생성한 프로젝트별 캐시 디렉토리(.gradle)
2. 버전별 캐시
3. Gradle 이 모든 빌드 아티팩트를 생성하는 이 프로젝트의 빌드 디렉토리 (build)
4. JAR 파일, Gradle Wrapper 구성 (gradle/wrapper)
5. 프로젝트별 Gradle 구성 속성(gradle.properties)
6. Gradle Wrapper 를 사용하여 빌드를 실행하기 위한 스크립트(gradlew, gradlew.bat)
7. 하위 프로젝트 목록이 정의된 프로젝트의 설정 파일(settings.gradle)
8. 하위 프로젝트들
9. 하위 프로젝트에는 자체 gradle 빌드 스크립트가 있다.


## 빌드 스크립트 기본 사항

gradle 명령을 사용하여 Gradle 빌드를 실행한다. 이 명령은 build.gradle 파일에서 실행된다.
build.gradle 을 빌드 스크립트라 한다.

이 빌드 스크립트는 hello 라는 단일 작업을 정의하고 추가한다.
`gradle hello` 하면 Gradle 이 hello 작업을 실행하고 제공된 작업을 차례로 실행한다.

### 빌드 스크립트는 코드이다.
Groovy, Kotlin 의 모든 기능을 제공한다.

### 작업 종속성.
다른 작업에 의존하는 작업을 선언할 수 있다.
종속성을 추가하기 위해 해당 테스크가 존재할 필요는 없다.
Lazy dependsOn

### 기존 작업 조작
작업이 등록되면 API 를 통해 엑세스할 수 있다.
이를 사용하여 런타임에 작업에 종속성을 동적으로 추가할 수 있다.
또는 기존 작업에 동작을 추가할 수 있다. `doFirst`, `doLast` 는 여러번 실행될 수 있다.

### 유연한 작업 등록

### 메소드 사용
빌드 메소드를 확장한다.
멀티 프로젝트 빌드의 하위 프로젝트 간에 이러한 메소드를 공유할 수 있다.
빌드 로직이 더 복잡해지면 다른 편리한 방법을 제공한다.

### 기본 작업
Gradle 을 사용하면 다른 작업이 지정되지 않은 경우 실행되는 하나 이상의 기본 작업을 정의할 수 있다.

### 빌드 스크립트의 외부 종속성
빌드 스크립트에서 외부 라이브러리를 사용해야 하는 경우 빌드 스크립트 자체에서 스크립트의 클래스 경로에 추가할 수 있다.
`buildscript()` 빌드 스크립트 클래스 경로를 선언하는 블록을 전달하는 메서드를 사용해 작업 수행.

`buildscript()` 메서드에 전달된 블록은 `ScriptHandler` 인스턴스를 구성한다.
빌드 스크립트에서 클래스 경로를 선언하면 클래스 경로의 다른 클래스처럼 빌드 스크립트에서 클래스를 사용할 수 있다.

멀티 프로젝트 빌드의 경우 프로젝트의 `buildscript()` 메서드로 선언된 종속성은 모든 하위 프로젝트의 빌드 스크립트에서 사용할 수 있다.


## 빌드 스크립트 작성
빌드 스크립트의 거의 모든 최상위 속성과 블록은 `Project` API의 일부이다.

### 표준 프로젝트 속성
`Project` 객체는 표준 속성을 제공한다.
* project: Project 인스턴스
* name: 프로젝트 디렉토리 이름
* path: 프로젝트 절대 경로
* description: 프로젝트 설명
* projectDir: File 빌드 스크립트가 포함된 디렉토리
* buildDir: File projectDir/build
* group: Object
* version: Object
* ant: AntBuilder 인스턴스

### 변수 선언
지역 변수는 `def` 키워드로 선언

### 추가 속성

### 임의 객체 구성

### 외부 스크립트를 사용하여 임의 객체 구성

### Groovy 기본 사항
Groovy 는 표준 JAVA 클래스에 많은 유용한 메서드를 추가한다.

자동으로 속성 참조를 적절한 Getter, Setter 메서드에 대한 호출로 변환한다.

괄호 없는 메서드 호출.

메소드의 마지막 매개변수가 클로저인 경우 메소드 호출 뒤에 클로저를 배치할 수 있다.


## Gradle 플러그인 사용
플러그인은 새로운 작업, 도메인 객체, 규칙을 추가하고 다른 플러그인 객체를 확장한다.

### 플러그인의 종류
바이너리 플러그인과 스크립트 플러그인이 있다.
바이너리 플러그인은 `Plugin` 인터페이스를 구현하거나 DSL 언어중 하나를 사용하여 작성된다.
빌드 스크립트 내, 프로젝트 계층 내, 외부 플러그인 jar 에 있을 수 있다.
스크립트 플러그인은 추가 빌드 스크립트이다.

플러그인은 스크립트 플러그인으로 시작하고 후에 바이너리 플러그인으로 마이그레이션한다.

### 바이너리 플러그인
바이너리 플러그인의 위치

* 플러그인 포털의 플러그인, 플러그인 DSL 을 사용하는 커스텀 레포지토리
* buildscript 종속성으로 정의된 외부 jar vmffjrmdls
* 플러그인을 프로젝트의 buildSrc 디렉터리 아래 소스 파일로 정의

플러그인 DSL 로 플러그인 적용

`plugins {}`과 `apply()` 차이

`plugins {}` 블록은 임의 코드를 지원하지 않는다.
id, version 은 상수, 리터럴, 문자열이어야 하고
apply 명령문을 사용하여 플러그인을 즉시 적용하는 기본 동작을 비활성화 할 수 있다.
(예로 `subprojects` 에서만 적용하려는 경우)

`plugins {}` 블록은 buildscript 에서 최상위 수준의 구문이어야 한다.

하위 프로젝트에 동일한 버전의 외부 플러그인 적용

`apply false` 구문을 사용하여 특정 하위 프로젝트에만 플러그인 적용

buildSrc 디렉토리에서 플러그인 적용

플러그인 관리
프로젝트별 및 전역으로 pluginManagement 구성(`settings.gralde`, `init.gradle`)

사용자 지정 플러그인 저장소
커스텀 플러그인 리포지토리를 지정하려면 `repositories {}` 블록을 사용해라.

플러그인 버전 관리
`pluginManagement {}` 안에 `plugins {}` 내부 블록을 사용하면 모든 플러그인 버전을 단일 위치에서 정의할 수 있다.

플러그인 해결 규칙
`plugins {}` 버전을 변경하거나 아티팩트를 명시적으로 지정하는 등 블록에서 이루어진 플러그인 요청을 수정할 수 있다.
`pluginManagement {}` 블록 안 `resolutionStrategy {}`

플러그인 마커 아티팩트

#### 바이너리 플러그인 적용
플러그인은 플러그인 id 를 사용하여 적용할 수 있다.

#### buildscript 블록으로 플러그인 적용
외부 jar 파일로 게시된 바이너리 플러그인은 `buildscript` 경로에 플러그인을 추가한 다음 플러그인을 적용하여 프로젝트에 추가할 수 있다.


### 스크립트 플러그인
스크립트 플러그인은 자동으로 해결되며 로컬 파일 시스템 또는 원격 위치 스크립트에서 적용할 수 있다.
파일 시스템 위치는 프로젝트 디렉토리에 상대적이고, 원격 스크립트 위치는 HTTP_URL 로 지정된다.